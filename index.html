<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramadan 1447H</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0f172a;
            --accent: #d4af37;
            --accent-light: #f4e4bc;
            --glass: rgba(15, 23, 42, 0.7);
        }
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .font-serif {
            font-family: 'Playfair Display', serif;
        }
        
        body {
            background: linear-gradient(180deg, #020617 0%, #0f172a 50%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
        }
        
        .luxury-gradient {
            background: linear-gradient(135deg, #d4af37 0%, #f4e4bc 50%, #d4af37 100%);
        }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(212, 175, 55, 0.1);
        }
        
        .glass-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(212, 175, 55, 0.15);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        
        .text-gold {
            color: #d4af37;
        }
        
        .border-gold {
            border-color: rgba(212, 175, 55, 0.3);
        }
        
        .bg-gold {
            background-color: #d4af37;
        }
        
        .timer-digit {
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.02em;
        }
        
        .elegant-shadow {
            box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.6), 
                        0 0 0 1px rgba(212, 175, 55, 0.1);
        }
        
        .nav-item {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .nav-item.active {
            color: #d4af37;
            transform: translateY(-2px);
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: #d4af37;
            border-radius: 50%;
        }
        
        .checkbox-luxury {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
            background: transparent;
        }
        
        .checkbox-luxury:checked {
            background: #d4af37;
            border-color: #d4af37;
        }
        
        .checkbox-luxury:checked::after {
            content: '';
            position: absolute;
            left: 6px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid #0f172a;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
        
        .checkbox-luxury:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.875rem;
            position: relative;
        }
        
        .calendar-day:hover {
            background: rgba(212, 175, 55, 0.1);
        }
        
        .calendar-day.active {
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid rgba(212, 175, 55, 0.5);
            color: #d4af37;
        }
        
        .calendar-day.today {
            background: #d4af37;
            color: #0f172a;
            font-weight: 600;
        }
        
        .calendar-day.has-data::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 4px;
            height: 4px;
            background: #10b981;
            border-radius: 50%;
        }
        
        .calendar-day.no-fasting {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            color: #ef4444;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: #334155;
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .toggle-switch.active {
            background: #d4af37;
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .toggle-switch.active::after {
            transform: translateX(24px);
        }
        
        .slide-container {
            display: flex;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .slide-panel {
            min-width: 100%;
            padding: 0 1.5rem;
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-clamp: 2;
            box-orient: vertical;
            overflow: hidden;
        }
        
        .expandable-text {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-clamp: 2;
            box-orient: vertical;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .expandable-text.expanded {
            display: block;
            -webkit-line-clamp: unset;
            line-clamp: unset;
        }
        
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .celebration {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confetti-fall 3s ease-out forwards;
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        .star-burst {
            position: absolute;
            font-size: 24px;
            animation: star-burst 1s ease-out forwards;
        }
        
        @keyframes star-burst {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            100% { transform: scale(2) rotate(180deg); opacity: 0; }
        }
        
        .pulse-gold {
            animation: pulse-gold 2s infinite;
        }
        
        @keyframes pulse-gold {
            0%, 100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.4); }
            50% { box-shadow: 0 0 0 20px rgba(212, 175, 55, 0); }
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .memory-item {
            break-inside: avoid;
            margin-bottom: 1rem;
        }
        
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-completed {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .status-pending {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }
        
        .status-missed {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .haid-mode {
            position: relative;
        }
        
        .haid-mode::before {
            content: 'ðŸ©¸';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 12px;
            z-index: 10;
        }
        
        .auto-save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .auto-save-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .streak-flame {
            animation: flicker 1s infinite alternate;
        }
        
        @keyframes flicker {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.1); opacity: 0.8; }
        }
    </style>
</head>
<body class="antialiased">
    <!-- Auto Save Indicator -->
    <div id="auto-save-indicator" class="auto-save-indicator">
        <i class="fas fa-check-circle mr-2"></i> Tersimpan otomatis
    </div>

    <!-- Celebration Container -->
    <div id="celebration-container" class="celebration fixed inset-0 pointer-events-none"></div>

    <!-- Main Container -->
    <div class="max-w-md mx-auto min-h-screen pb-24 relative overflow-hidden">
        
        <!-- Decorative Elements -->
        <div class="fixed top-0 left-0 w-full h-96 bg-gradient-to-b from-amber-900/20 to-transparent pointer-events-none"></div>
        <div class="fixed top-20 right-0 w-64 h-64 bg-amber-500/5 rounded-full blur-3xl pointer-events-none"></div>
        <div class="fixed bottom-40 left-0 w-48 h-48 bg-emerald-500/5 rounded-full blur-3xl pointer-events-none"></div>

        <!-- Header -->
        <header class="relative z-10 pt-12 pb-6 px-6 text-center">
            <p class="text-gold text-xs tracking-[0.3em] uppercase mb-2 font-medium">Ramadan 1447 H</p>
            <h1 class="font-serif text-3xl text-white italic mb-1" id="current-date">18 Februari 2026</h1>
            <p class="text-slate-400 text-sm" id="ramadan-day">Hari ke-1</p>
        </header>

        <!-- PAGE 1: HOME -->
        <main id="page-home" class="page-content px-6 space-y-6 fade-in">
            
            <!-- Prayer Countdown Timer -->
            <div class="glass-card rounded-3xl p-6 elegant-shadow relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-amber-500/10 to-transparent rounded-full blur-2xl"></div>
                
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <p class="text-slate-400 text-xs uppercase tracking-wider mb-1">Selanjutnya</p>
                        <h2 class="text-2xl font-serif text-white" id="next-prayer-name">Maghrib</h2>
                        <p class="text-gold text-sm mt-1" id="prayer-time">18:12</p>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center text-slate-900">
                        <i class="fas fa-moon" id="prayer-icon"></i>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-2 text-center">
                    <div class="glass-panel rounded-2xl p-3">
                        <span class="block text-2xl font-bold text-white timer-digit" id="countdown-hours">00</span>
                        <span class="text-[10px] text-slate-400 uppercase tracking-wider">Jam</span>
                    </div>
                    <div class="glass-panel rounded-2xl p-3">
                        <span class="block text-2xl font-bold text-white timer-digit" id="countdown-minutes">00</span>
                        <span class="text-[10px] text-slate-400 uppercase tracking-wider">Menit</span>
                    </div>
                    <div class="glass-panel rounded-2xl p-3">
                        <span class="block text-2xl font-bold text-white timer-digit" id="countdown-seconds">00</span>
                        <span class="text-[10px] text-slate-400 uppercase tracking-wider">Detik</span>
                    </div>
                </div>
            </div>

            <!-- Daily Progress -->
            <div class="glass-card rounded-3xl p-6 elegant-shadow">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 class="font-serif text-xl text-white">Target Harian</h3>
                        <p class="text-slate-400 text-xs mt-1">Minimal 500 poin â€¢ Target 1000 poin</p>
                    </div>
                    <div class="relative w-16 h-16">
                        <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                            <path class="text-slate-700" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3"/>
                            <path id="progress-circle" class="text-gold progress-ring-circle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                        </svg>
                        <span class="absolute inset-0 flex items-center justify-center text-sm font-bold text-white" id="progress-percent">0%</span>
                    </div>
                </div>

                <div class="flex justify-between text-sm mb-2">
                    <span class="text-slate-400">Progress</span>
                    <span class="text-gold font-semibold"><span id="current-points">0</span> / 1000 poin</span>
                </div>
                <div class="h-1.5 bg-slate-700 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-gradient-to-r from-amber-600 to-amber-400 rounded-full transition-all duration-700" style="width: 0%"></div>
                </div>
            </div>

            <!-- Haid Toggle -->
            <div class="glass-card rounded-2xl p-4 border border-rose-500/30 bg-rose-500/5" id="haid-banner" style="display: none;">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-rose-500/20 flex items-center justify-center text-rose-400">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div>
                            <p class="text-rose-300 text-sm font-medium">Mode Haid Aktif</p>
                            <p class="text-rose-400/70 text-xs line-clamp-2">Puasa & Sholat dinonaktifkan</p>
                        </div>
                    </div>
                    <button onclick="toggleHaid(false)" class="text-xs bg-rose-500/20 text-rose-300 px-3 py-1.5 rounded-full hover:bg-rose-500/30 transition">
                        Beres Haid
                    </button>
                </div>
            </div>

            <!-- Amalan Form -->
            <div class="space-y-4" id="amalan-container">
                
                <!-- Puasa -->
                <div class="glass-card rounded-2xl p-5 border-l-4 border-l-amber-500/50 amalan-item" data-type="puasa">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500/20 to-amber-600/10 flex items-center justify-center text-amber-400">
                                <i class="fas fa-utensils"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-medium">Puasa</h4>
                                <p class="text-xs text-slate-400">+100 poin</p>
                            </div>
                        </div>
                        <div class="toggle-switch" id="toggle-puasa" onclick="toggleAmalan('puasa')"></div>
                    </div>
                    <p class="text-xs text-slate-500 mt-2 line-clamp-2" id="status-puasa">Tap toggle untuk puasa full</p>
                </div>

                <!-- Sholat Wajib -->
                <div class="glass-card rounded-2xl p-5 border-l-4 border-l-blue-500/50 amalan-item" data-type="sholat">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500/20 to-blue-600/10 flex items-center justify-center text-blue-400">
                            <i class="fas fa-mosque"></i>
                        </div>
                        <div>
                            <h4 class="text-white font-medium">Sholat Fardhu</h4>
                            <p class="text-xs text-slate-400">+20 poin/waktu</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-5 gap-2">
                        <label class="flex flex-col items-center gap-2 cursor-pointer">
                            <input type="checkbox" class="checkbox-luxury" id="sholat-subuh" onchange="updateAmalan(true)">
                            <span class="text-[10px] text-slate-400 line-clamp-2">Subuh</span>
                        </label>
                        <label class="flex flex-col items-center gap-2 cursor-pointer">
                            <input type="checkbox" class="checkbox-luxury" id="sholat-dzuhur" onchange="updateAmalan(true)">
                            <span class="text-[10px] text-slate-400 line-clamp-2">Dzuhur</span>
                        </label>
                        <label class="flex flex-col items-center gap-2 cursor-pointer">
                            <input type="checkbox" class="checkbox-luxury" id="sholat-ashar" onchange="updateAmalan(true)">
                            <span class="text-[10px] text-slate-400 line-clamp-2">Ashar</span>
                        </label>
                        <label class="flex flex-col items-center gap-2 cursor-pointer">
                            <input type="checkbox" class="checkbox-luxury" id="sholat-maghrib" onchange="updateAmalan(true)">
                            <span class="text-[10px] text-slate-400 line-clamp-2">Maghrib</span>
                        </label>
                        <label class="flex flex-col items-center gap-2 cursor-pointer">
                            <input type="checkbox" class="checkbox-luxury" id="sholat-isya" onchange="updateAmalan(true)">
                            <span class="text-[10px] text-slate-400 line-clamp-2">Isya</span>
                        </label>
                    </div>
                </div>

                <!-- Sholat Sunnah -->
                <div class="glass-card rounded-2xl p-5 border-l-4 border-l-emerald-500/50 amalan-item" data-type="sunnah">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500/20 to-emerald-600/10 flex items-center justify-center text-emerald-400">
                            <i class="fas fa-praying-hands"></i>
                        </div>
                        <div>
                            <h4 class="text-white font-medium">Sholat Sunnah</h4>
                            <p class="text-xs text-slate-400">Pahala berlipat</p>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <label class="flex items-center justify-between cursor-pointer group p-2 rounded-lg hover:bg-white/5 transition">
                            <span class="text-sm text-slate-300 line-clamp-2">Rawatib Qabliyah & Ba'diyah</span>
                            <div class="flex items-center gap-2">
                                <span class="text-xs text-emerald-400">+50</span>
                                <input type="checkbox" class="checkbox-luxury" id="sunnah-rawatib" onchange="updateAmalan(true)">
                            </div>
                        </label>
                        <label class="flex items-center justify-between cursor-pointer group p-2 rounded-lg hover:bg-white/5 transition">
                            <span class="text-sm text-slate-300 line-clamp-2">Dhuha (2-12 rakaat)</span>
                            <div class="flex items-center gap-2">
                                <span class="text-xs text-emerald-400">+30</span>
                                <input type="checkbox" class="checkbox-luxury" id="sunnah-dhuha" onchange="updateAmalan(true)">
                            </div>
                        </label>
                        <label class="flex items-center justify-between cursor-pointer group p-2 rounded-lg hover:bg-white/5 transition">
                            <span class="text-sm text-slate-300 line-clamp-2">Tahajud</span>
                            <div class="flex items-center gap-2">
                                <span class="text-xs text-emerald-400">+100</span>
                                <input type="checkbox" class="checkbox-luxury" id="sunnah-tahajud" onchange="updateAmalan(true)">
                            </div>
                        </label>
                        
                        <!-- Tarawih with rakaat count -->
                        <div class="p-2 rounded-lg bg-white/5">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm text-slate-300 line-clamp-2">Tarawih</span>
                                <span class="text-xs text-emerald-400">+100 (full 23)</span>
                            </div>
                            <div class="flex items-center gap-3 flex-wrap">
                                <input type="checkbox" class="checkbox-luxury" id="sunnah-tarawih" onchange="updateAmalan(true)">
                                <span class="text-xs text-slate-400 line-clamp-2">Saya sholat</span>
                                <input type="number" id="tarawih-rakaat" min="0" max="23" placeholder="Rakaat" class="w-20 bg-slate-800 border border-slate-700 rounded-lg px-2 py-1 text-sm text-white text-center" onchange="updateAmalan(true)">
                                <span class="text-xs text-slate-500 line-clamp-2">/ 23</span>
                            </div>
                            <p class="text-xs text-emerald-400 mt-1" id="tarawih-points">0 poin</p>
                        </div>
                        
                        <label class="flex items-center justify-between cursor-pointer group p-2 rounded-lg hover:bg-white/5 transition">
                            <span class="text-sm text-slate-300 line-clamp-2">Witir</span>
                            <div class="flex items-center gap-2">
                                <span class="text-xs text-emerald-400">+40</span>
                                <input type="checkbox" class="checkbox-luxury" id="sunnah-witir" onchange="updateAmalan(true)">
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Ngaji -->
                <div class="glass-card rounded-2xl p-5 border-l-4 border-l-purple-500/50">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500/20 to-purple-600/10 flex items-center justify-center text-purple-400">
                            <i class="fas fa-book-quran"></i>
                        </div>
                        <div>
                            <h4 class="text-white font-medium">Tilawah Quran</h4>
                            <p class="text-xs text-slate-400">+2 poin/ayat</p>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-slate-400 block mb-1 line-clamp-2">Surat Awal</label>
                                <select id="ngaji-surat-awal" class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:border-amber-500/50 focus:outline-none" onchange="updateAmalan(true)">
                                    <option value="">Pilih Surat</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 block mb-1 line-clamp-2">Ayat Awal</label>
                                <input type="number" id="ngaji-ayat-awal" class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:border-amber-500/50 focus:outline-none" placeholder="1" onchange="updateAmalan(true)">
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-center">
                            <span class="text-slate-500 text-xs">sampai</span>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-slate-400 block mb-1 line-clamp-2">Surat Akhir</label>
                                <select id="ngaji-surat-akhir" class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:border-amber-500/50 focus:outline-none" onchange="updateAmalan(true)">
                                    <option value="">Sama dengan awal</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 block mb-1 line-clamp-2">Ayat Akhir</label>
                                <input type="number" id="ngaji-ayat-akhir" class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:border-amber-500/50 focus:outline-none" placeholder="7" onchange="updateAmalan(true)">
                            </div>
                        </div>
                        
                        <p class="text-xs text-purple-400 text-right" id="ngaji-total">0 ayat â€¢ 0 poin</p>
                    </div>
                </div>

                <!-- Lainnya -->
                <div class="glass-card rounded-2xl p-5 border-l-4 border-l-rose-500/50">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-rose-500/20 to-rose-600/10 flex items-center justify-center text-rose-400">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div>
                            <h4 class="text-white font-medium">Amalan Lain</h4>
                            <p class="text-xs text-slate-400">Kebaikan tambahan</p>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <label class="flex items-center justify-between cursor-pointer group p-2 rounded-lg hover:bg-white/5 transition">
                            <span class="text-sm text-slate-300 line-clamp-2">Dzikir pagi & petang</span>
                            <div class="flex items-center gap-2">
                                <span class="text-xs text-rose-400">+40</span>
                                <input type="checkbox" class="checkbox-luxury" id="lain-dzikir" onchange="updateAmalan(true)">
                            </div>
                        </label>
                        <div class="flex items-center justify-between p-2">
                            <span class="text-sm text-slate-300 line-clamp-2">Infaq/Sedekah</span>
                            <div class="flex items-center gap-2">
                                <span class="text-xs text-rose-400">+1/1000</span>
                                <input type="number" id="lain-infaq" class="w-24 bg-slate-800/50 border border-slate-700 rounded-lg px-2 py-1 text-sm text-white focus:border-amber-500/50 focus:outline-none text-right" placeholder="Rp" onchange="updateAmalan(true)">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manual Save Button (Backup) -->
                <button onclick="manualSave()" class="w-full py-4 bg-gradient-to-r from-amber-600 to-amber-500 text-slate-900 font-bold rounded-2xl shadow-lg shadow-amber-500/25 transform active:scale-[0.98] transition-all hover:shadow-amber-500/40" id="save-btn">
                    <i class="fas fa-save mr-2"></i> Simpan Progress
                </button>
                
                <p class="text-center text-xs text-slate-500 mt-2">
                    <i class="fas fa-info-circle mr-1"></i> Data tersimpan otomatis setiap perubahan
                </p>
            </div>
        </main>

        <!-- PAGE 2: TODO -->
        <main id="page-todo" class="page-content hidden">
            <!-- Toggle Switch -->
            <div class="px-6 mb-6">
                <div class="glass-card rounded-2xl p-4 flex items-center justify-between">
                    <span class="text-sm text-slate-300 line-clamp-2" id="todo-label-left">Bacaan</span>
                    <div class="toggle-switch" id="todo-toggle" onclick="toggleTodoSlide()"></div>
                    <span class="text-sm text-slate-500 line-clamp-2" id="todo-label-right">Workout</span>
                </div>
            </div>

            <!-- Slider Container -->
            <div class="overflow-hidden">
                <div class="slide-container" id="todo-slider">
                    
                    <!-- Panel 1: Bacaan -->
                    <div class="slide-panel">
                        <div class="mb-4 px-6">
                            <h3 class="font-serif text-xl text-white">Target Bacaan 30 Hari</h3>
                            <p class="text-xs text-slate-400 line-clamp-2">Buku, artikel, atau materi lainnya</p>
                        </div>
                        
                        <div id="reading-list" class="space-y-3 px-6">
                            <!-- Populated by JS -->
                        </div>
                        
                        <button onclick="openTodoModal('reading')" class="mx-6 mt-4 w-[calc(100%-3rem)] py-4 border-2 border-dashed border-slate-700 rounded-2xl text-slate-400 hover:border-amber-500/50 hover:text-amber-400 transition flex items-center justify-center gap-2">
                            <i class="fas fa-plus"></i>
                            <span class="line-clamp-2">Tambah Target Bacaan</span>
                        </button>
                    </div>

                    <!-- Panel 2: Workout -->
                    <div class="slide-panel">
                        <div class="mb-4 px-6">
                            <h3 class="font-serif text-xl text-white">Target Workout 30 Hari</h3>
                            <p class="text-xs text-slate-400 line-clamp-2">Olahraga dan aktivitas fisik</p>
                        </div>
                        
                        <div id="workout-list" class="space-y-3 px-6">
                            <!-- Populated by JS -->
                        </div>
                        
                        <button onclick="openTodoModal('workout')" class="mx-6 mt-4 w-[calc(100%-3rem)] py-4 border-2 border-dashed border-slate-700 rounded-2xl text-slate-400 hover:border-amber-500/50 hover:text-amber-400 transition flex items-center justify-center gap-2">
                            <i class="fas fa-plus"></i>
                            <span class="line-clamp-2">Tambah Target Workout</span>
                        </button>
                    </div>
                    
                </div>
            </div>
        </main>

        <!-- PAGE 3: PROFILE -->
        <main id="page-profile" class="page-content px-6 space-y-6 hidden">
            
            <!-- Profile Card -->
            <div class="glass-card rounded-3xl p-6 text-center elegant-shadow relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-2 luxury-gradient"></div>
                
                <div class="relative inline-block mb-4">
                    <div class="w-28 h-28 mx-auto rounded-full bg-gradient-to-br from-amber-400 to-amber-600 p-1 cursor-pointer hover:scale-105 transition" onclick="document.getElementById('profile-photo-input').click()">
                        <div class="w-full h-full rounded-full bg-slate-900 flex items-center justify-center overflow-hidden" id="profile-photo-container">
                            <i class="fas fa-user text-4xl text-slate-600" id="profile-default-icon"></i>
                            <img id="profile-photo" class="w-full h-full object-cover hidden">
                        </div>
                    </div>
                    <div class="absolute bottom-0 right-0 w-8 h-8 bg-amber-500 rounded-full flex items-center justify-center text-slate-900 cursor-pointer hover:bg-amber-400 transition" onclick="document.getElementById('profile-photo-input').click()">
                        <i class="fas fa-camera text-xs"></i>
                    </div>
                    <input type="file" id="profile-photo-input" class="hidden" accept="image/*" onchange="updateProfilePhoto(this)">
                </div>
                
                <div class="mb-4">
                    <input type="text" id="profile-name" class="bg-transparent text-center text-2xl font-serif text-white border-b border-transparent hover:border-amber-500/50 focus:border-amber-500 focus:outline-none transition w-full" placeholder="Nama Kamu" onchange="saveProfile()">
                    <input type="text" id="profile-quote" class="bg-transparent text-center text-sm text-slate-400 italic mt-2 border-b border-transparent hover:border-amber-500/50 focus:border-amber-500 focus:outline-none transition w-full line-clamp-2" placeholder="Quotes favoritmu..." onchange="saveProfile()">
                </div>
                
                <div class="grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-slate-700/50">
                    <div class="text-center">
                        <p class="text-2xl font-bold text-gold" id="profile-total-days">0</p>
                        <p class="text-[10px] text-slate-400 uppercase tracking-wider line-clamp-2">Hari Puasa</p>
                    </div>
                    <div class="text-center">
                        <p class="text-2xl font-bold text-gold" id="profile-avg-score">0</p>
                        <p class="text-[10px] text-slate-400 uppercase tracking-wider line-clamp-2">Rata-rata</p>
                    </div>
                    <div class="text-center">
                        <p class="text-2xl font-bold text-gold" id="profile-best-score">0</p>
                        <p class="text-[10px] text-slate-400 uppercase tracking-wider line-clamp-2">Terbaik</p>
                    </div>
                </div>
            </div>

            <!-- Haid Control -->
            <div class="glass-card rounded-2xl p-4 border border-rose-500/20">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-rose-500/20 flex items-center justify-center text-rose-400">
                            <i class="fas fa-heart-pulse"></i>
                        </div>
                        <div>
                            <p class="text-white text-sm font-medium line-clamp-2">Status Haid</p>
                            <p class="text-slate-400 text-xs line-clamp-2" id="haid-status-text">Tidak haid</p>
                        </div>
                    </div>
                    <button onclick="toggleHaid(true)" id="btn-haid-on" class="text-xs bg-rose-500/20 text-rose-300 px-4 py-2 rounded-full hover:bg-rose-500/30 transition">
                        Mulai Haid
                    </button>
                    <button onclick="toggleHaid(false)" id="btn-haid-off" class="text-xs bg-emerald-500/20 text-emerald-300 px-4 py-2 rounded-full hover:bg-emerald-500/30 transition hidden">
                        Beres Haid
                    </button>
                </div>
            </div>

            <!-- Calendar -->
            <div class="glass-card rounded-3xl p-6 elegant-shadow">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-serif text-lg text-white">Kalender Ramadan</h3>
                    <div class="flex gap-2">
                        <button onclick="changeMonth(-1)" class="w-8 h-8 rounded-lg bg-slate-800 flex items-center justify-center text-slate-400 hover:text-white transition">
                            <i class="fas fa-chevron-left text-xs"></i>
                        </button>
                        <span class="text-sm text-slate-300 self-center line-clamp-2" id="calendar-month">Februari 2026</span>
                        <button onclick="changeMonth(1)" class="w-8 h-8 rounded-lg bg-slate-800 flex items-center justify-center text-slate-400 hover:text-white transition">
                            <i class="fas fa-chevron-right text-xs"></i>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-7 gap-1 mb-2">
                    <span class="text-center text-[10px] text-slate-500 uppercase line-clamp-2">Ah</span>
                    <span class="text-center text-[10px] text-slate-500 uppercase line-clamp-2">Se</span>
                    <span class="text-center text-[10px] text-slate-500 uppercase line-clamp-2">Se</span>
                    <span class="text-center text-[10px] text-slate-500 uppercase line-clamp-2">Ra</span>
                    <span class="text-center text-[10px] text-slate-500 uppercase line-clamp-2">Ka</span>
                    <span class="text-center text-[10px] text-slate-500 uppercase line-clamp-2">Ju</span>
                    <span class="text-center text-[10px] text-slate-500 uppercase line-clamp-2">Sa</span>
                </div>
                
                <div class="grid grid-cols-7 gap-1" id="calendar-grid"></div>
                
                <!-- Day Detail (Below Calendar) -->
                <div id="day-detail" class="mt-6 pt-6 border-t border-slate-700/50 hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-serif text-lg text-white line-clamp-2" id="day-detail-date">18 Februari 2026</h4>
                        <span class="text-gold font-bold" id="day-detail-score">850 poin</span>
                    </div>
                    <div id="day-detail-content" class="space-y-2"></div>
                </div>
            </div>

            <!-- Memories -->
            <div>
                <h3 class="font-serif text-xl text-white mb-4">Kenangan</h3>
                <div id="memories-list" class="space-y-4">
                    <!-- Populated by JS -->
                </div>
                
                <div class="flex gap-3 mt-4">
                    <button onclick="document.getElementById('memory-gallery').click()" class="flex-1 py-3 bg-slate-800 rounded-xl text-slate-300 hover:bg-slate-700 transition flex items-center justify-center gap-2">
                        <i class="fas fa-images"></i>
                        <span class="text-sm line-clamp-2">Galeri</span>
                    </button>
                    <button onclick="document.getElementById('memory-camera').click()" class="flex-1 py-3 bg-amber-500/20 border border-amber-500/30 rounded-xl text-amber-400 hover:bg-amber-500/30 transition flex items-center justify-center gap-2">
                        <i class="fas fa-camera"></i>
                        <span class="text-sm line-clamp-2">Foto Langsung</span>
                    </button>
                </div>
                <input type="file" id="memory-gallery" class="hidden" accept="image/*" onchange="handleMemoryUpload(this, 'gallery')">
                <input type="file" id="memory-camera" class="hidden" accept="image/*" capture="environment" onchange="handleMemoryUpload(this, 'camera')">
            </div>
        </main>

        <!-- Todo Detail Modal -->
        <div id="todo-modal" class="fixed inset-0 z-50 hidden">
            <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeTodoModal()"></div>
            <div class="absolute bottom-0 left-0 right-0 bg-slate-900 rounded-t-3xl p-6 max-w-md mx-auto slide-up max-h-[90vh] overflow-y-auto">
                <div class="w-12 h-1 bg-slate-700 rounded-full mx-auto mb-6"></div>
                
                <h3 class="font-serif text-2xl text-white mb-6" id="modal-title">Tambah Target</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="text-xs text-slate-400 uppercase tracking-wider block mb-2 line-clamp-2">Judul</label>
                        <input type="text" id="todo-title" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-amber-500/50 focus:outline-none" placeholder="Contoh: Buku Atomic Habits">
                    </div>
                    
                    <div>
                        <label class="text-xs text-slate-400 uppercase tracking-wider block mb-2 line-clamp-2">Target Harian</label>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="setTodoFrequency('daily')" id="freq-daily" class="p-3 rounded-xl border border-amber-500 bg-amber-500/10 text-amber-400 text-sm transition">Setiap Hari</button>
                            <button onclick="setTodoFrequency('weekly')" id="freq-weekly" class="p-3 rounded-xl border border-slate-700 text-slate-400 text-sm transition">Beberapa Kali</button>
                        </div>
                    </div>
                    
                    <div id="days-selector" style="display: none;">
                        <label class="text-xs text-slate-400 uppercase tracking-wider block mb-2 line-clamp-2">Pilih Hari</label>
                        <div class="flex gap-2 flex-wrap">
                            <label class="flex items-center gap-2 cursor-pointer bg-slate-800 px-3 py-2 rounded-lg">
                                <input type="checkbox" class="checkbox-luxury scale-75" value="1">
                                <span class="text-xs line-clamp-2">Sen</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer bg-slate-800 px-3 py-2 rounded-lg">
                                <input type="checkbox" class="checkbox-luxury scale-75" value="2">
                                <span class="text-xs line-clamp-2">Sel</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer bg-slate-800 px-3 py-2 rounded-lg">
                                <input type="checkbox" class="checkbox-luxury scale-75" value="3">
                                <span class="text-xs line-clamp-2">Rab</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer bg-slate-800 px-3 py-2 rounded-lg">
                                <input type="checkbox" class="checkbox-luxury scale-75" value="4">
                                <span class="text-xs line-clamp-2">Kam</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer bg-slate-800 px-3 py-2 rounded-lg">
                                <input type="checkbox" class="checkbox-luxury scale-75" value="5">
                                <span class="text-xs line-clamp-2">Jum</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer bg-slate-800 px-3 py-2 rounded-lg">
                                <input type="checkbox" class="checkbox-luxury scale-75" value="6">
                                <span class="text-xs line-clamp-2">Sab</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer bg-slate-800 px-3 py-2 rounded-lg">
                                <input type="checkbox" class="checkbox-luxury scale-75" value="0">
                                <span class="text-xs line-clamp-2">Min</span>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label class="text-xs text-slate-400 uppercase tracking-wider block mb-2 line-clamp-2">Poin (jika selesai)</label>
                        <input type="number" id="todo-points" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-amber-500/50 focus:outline-none" value="20">
                    </div>
                    
                    <div>
                        <label class="text-xs text-slate-400 uppercase tracking-wider block mb-2 line-clamp-2">Deskripsi</label>
                        <textarea id="todo-desc" rows="3" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-amber-500/50 focus:outline-none resize-none" placeholder="Detail target..."></textarea>
                    </div>
                </div>
                
                <button onclick="saveTodo()" class="w-full mt-6 py-4 bg-gradient-to-r from-amber-600 to-amber-500 text-slate-900 font-bold rounded-xl">
                    Simpan Target
                </button>
            </div>
        </div>

        <!-- Bottom Nav -->
        <nav class="fixed bottom-0 left-0 right-0 bg-slate-900/95 backdrop-blur-xl border-t border-slate-800 px-8 py-4 z-40 max-w-md mx-auto">
            <div class="flex justify-around items-center">
                <button onclick="switchTab('home')" id="nav-home" class="nav-item active relative flex flex-col items-center gap-1 text-slate-400 hover:text-slate-200">
                    <i class="fas fa-home text-lg"></i>
                    <span class="text-[10px] line-clamp-2">Home</span>
                </button>
                <button onclick="switchTab('todo')" id="nav-todo" class="nav-item relative flex flex-col items-center gap-1 text-slate-400 hover:text-slate-200">
                    <i class="fas fa-check-circle text-lg"></i>
                    <span class="text-[10px] line-clamp-2">To-Do</span>
                </button>
                <button onclick="switchTab('profile')" id="nav-profile" class="nav-item relative flex flex-col items-center gap-1 text-slate-400 hover:text-slate-200">
                    <i class="fas fa-user text-lg"></i>
                    <span class="text-[10px] line-clamp-2">Profile</span>
                </button>
            </div>
        </nav>

    </div>

    <script>
        // Data Structure - Enhanced for daily persistence
        let appData = {
            profile: {
                name: '',
                quote: '',
                photo: null
            },
            // Store by date string: "Wed Feb 18 2026"
            history: {},
            // Current day progress (auto-saved)
            currentDay: {
                date: null,
                data: null
            },
            todos: {
                reading: [],
                workout: []
            },
            memories: [],
            haid: {
                active: false,
                startDate: null,
                history: []
            },
            currentDate: new Date('2026-02-18'),
            todoFrequency: 'daily'
        };
        
        let currentMonth = new Date('2026-02-18');
        let currentTodoType = 'reading';
        let autoSaveTimeout = null;
        
        // Surat data
        const suratList = [
            {name: "Al-Fatihah", ayat: 7}, {name: "Al-Baqarah", ayat: 286}, {name: "Ali Imran", ayat: 200},
            {name: "An-Nisa", ayat: 176}, {name: "Al-Ma'idah", ayat: 120}, {name: "Al-An'am", ayat: 165},
            {name: "Al-A'raf", ayat: 206}, {name: "Al-Anfal", ayat: 75}, {name: "At-Taubah", ayat: 129},
            {name: "Yunus", ayat: 109}, {name: "Hud", ayat: 123}, {name: "Yusuf", ayat: 111},
            {name: "Ar-Ra'd", ayat: 43}, {name: "Ibrahim", ayat: 52}, {name: "Al-Hijr", ayat: 99},
            {name: "An-Nahl", ayat: 128}, {name: "Al-Isra", ayat: 111}, {name: "Al-Kahf", ayat: 110},
            {name: "Maryam", ayat: 98}, {name: "Taha", ayat: 135}, {name: "Al-Anbiya", ayat: 112},
            {name: "Al-Hajj", ayat: 78}, {name: "Al-Mu'minun", ayat: 118}, {name: "An-Nur", ayat: 64},
            {name: "Al-Furqan", ayat: 77}, {name: "Asy-Syu'ara", ayat: 227}, {name: "An-Naml", ayat: 93},
            {name: "Al-Qasas", ayat: 88}, {name: "Al-'Ankabut", ayat: 69}, {name: "Ar-Rum", ayat: 60}
        ];
        
        // Prayer times for Baros, Sukabumi
        const prayerTimes = {
            subuh: '04:38',
            dzuhur: '12:05',
            ashar: '15:15',
            maghrib: '18:12',
            isya: '19:22'
        };
        
        // Init
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            populateSuratOptions();
            updateTimer();
            setInterval(updateTimer, 1000);
            updateDate();
            
            // Load today's data if exists
            loadTodayData();
            
            renderTodos();
            renderCalendar();
            renderMemories();
            updateProfile();
            checkHaidStatus();
            
            // Setup beforeunload warning
            window.addEventListener('beforeunload', function(e) {
                if (autoSaveTimeout) {
                    clearTimeout(autoSaveTimeout);
                    autoSave();
                }
            });
        });
        
        function populateSuratOptions() {
            const awal = document.getElementById('ngaji-surat-awal');
            const akhir = document.getElementById('ngaji-surat-akhir');
            
            suratList.forEach(function(s, i) {
                const opt1 = new Option((i+1) + '. ' + s.name, i);
                const opt2 = new Option((i+1) + '. ' + s.name, i);
                awal.add(opt1);
                akhir.add(opt2);
            });
        }
        
        function updateDate() {
            const today = new Date();
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            document.getElementById('current-date').textContent = today.toLocaleDateString('id-ID', options);
            
            const ramadanStart = new Date('2026-02-19');
            const diffTime = today - ramadanStart;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
            document.getElementById('ramadan-day').textContent = 'Hari ke-' + (diffDays > 0 ? diffDays : 1);
        }
        
        function updateTimer() {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            const times = [
                { name: 'Subuh', time: prayerTimes.subuh, icon: 'fa-sun', minutes: parseTime(prayerTimes.subuh) },
                { name: 'Dzuhur', time: prayerTimes.dzuhur, icon: 'fa-sun', minutes: parseTime(prayerTimes.dzuhur) },
                { name: 'Ashar', time: prayerTimes.ashar, icon: 'fa-cloud-sun', minutes: parseTime(prayerTimes.ashar) },
                { name: 'Maghrib', time: prayerTimes.maghrib, icon: 'fa-moon', minutes: parseTime(prayerTimes.maghrib) },
                { name: 'Isya', time: prayerTimes.isya, icon: 'fa-star', minutes: parseTime(prayerTimes.isya) }
            ];
            
            let nextPrayer = times.find(function(t) { return t.minutes > currentTime; });
            if (!nextPrayer) nextPrayer = times[0];
            
            document.getElementById('next-prayer-name').textContent = nextPrayer.name;
            document.getElementById('prayer-time').textContent = nextPrayer.time;
            document.getElementById('prayer-icon').className = 'fas ' + nextPrayer.icon;
            
            let diff = nextPrayer.minutes - currentTime;
            if (diff < 0) diff += 24 * 60;
            
            const hours = Math.floor(diff / 60);
            const minutes = diff % 60;
            const seconds = 59 - now.getSeconds();
            
            document.getElementById('countdown-hours').textContent = String(hours).padStart(2, '0');
            document.getElementById('countdown-minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('countdown-seconds').textContent = String(seconds).padStart(2, '0');
        }
        
        function parseTime(timeStr) {
            const [h, m] = timeStr.split(':').map(Number);
            return h * 60 + m;
        }
        
        // Get current fasting date based on maghrib time
        function getCurrentFastingDate() {
            const now = new Date();
            const maghribTime = new Date(now);
            const [h, m] = prayerTimes.maghrib.split(':');
            maghribTime.setHours(parseInt(h), parseInt(m), 0);
            
            // If now is after maghrib, we're in the "next day" of fasting
            if (now > maghribTime) {
                const tomorrow = new Date(now);
                tomorrow.setDate(tomorrow.getDate() + 1);
                return tomorrow.toDateString();
            }
            return now.toDateString();
        }
        
        // Load today's saved data
        function loadTodayData() {
            const todayStr = getCurrentFastingDate();
            const savedData = appData.history[todayStr];
            
            if (savedData) {
                // Restore all form values
                restoreFormValues(savedData);
            }
            
            // Also set currentDay tracker
            appData.currentDay.date = todayStr;
            appData.currentDay.data = savedData || createEmptyDayData();
        }
        
        function createEmptyDayData() {
            return {
                date: getCurrentFastingDate(),
                score: 0,
                puasa: false,
                sholat: { subuh: false, dzuhur: false, ashar: false, maghrib: false, isya: false },
                sunnah: { rawatib: false, dhuha: false, tahajud: false, witir: false },
                tarawih: { done: false, rakaat: 0 },
                ngaji: { suratAwal: '', ayatAwal: '', suratAkhir: '', ayatAkhir: '' },
                lain: { dzikir: false, infaq: '' },
                haid: false
            };
        }
        
        function restoreFormValues(data) {
            // Puasa toggle
            if (data.puasa) {
                document.getElementById('toggle-puasa').classList.add('active');
                document.getElementById('status-puasa').textContent = 'Puasa full aktif âœ“';
                document.getElementById('status-puasa').classList.add('text-emerald-400');
            }
            
            // Sholat
            Object.keys(data.sholat).forEach(function(key) {
                const cb = document.getElementById('sholat-' + key);
                if (cb) cb.checked = data.sholat[key];
            });
            
            // Sunnah
            if (data.sunnah.rawatib) document.getElementById('sunnah-rawatib').checked = true;
            if (data.sunnah.dhuha) document.getElementById('sunnah-dhuha').checked = true;
            if (data.sunnah.tahajud) document.getElementById('sunnah-tahajud').checked = true;
            if (data.sunnah.witir) document.getElementById('sunnah-witir').checked = true;
            
            // Tarawih
            if (data.tarawih) {
                if (data.tarawih.done) document.getElementById('sunnah-tarawih').checked = true;
                if (data.tarawih.rakaat) document.getElementById('tarawih-rakaat').value = data.tarawih.rakaat;
            }
            
            // Ngaji
            if (data.ngaji) {
                if (data.ngaji.suratAwal) document.getElementById('ngaji-surat-awal').value = data.ngaji.suratAwal;
                if (data.ngaji.ayatAwal) document.getElementById('ngaji-ayat-awal').value = data.ngaji.ayatAwal;
                if (data.ngaji.suratAkhir) document.getElementById('ngaji-surat-akhir').value = data.ngaji.suratAkhir;
                if (data.ngaji.ayatAkhir) document.getElementById('ngaji-ayat-akhir').value = data.ngaji.ayatAkhir;
            }
            
            // Lainnya
            if (data.lain) {
                if (data.lain.dzikir) document.getElementById('lain-dzikir').checked = true;
                if (data.lain.infaq) document.getElementById('lain-infaq').value = data.lain.infaq;
            }
            
            // Recalculate score display
            updateAmalan(false);
        }
        
        function toggleAmalan(type) {
            const toggle = document.getElementById('toggle-' + type);
            const status = document.getElementById('status-' + type);
            
            toggle.classList.toggle('active');
            
            if (toggle.classList.contains('active')) {
                status.textContent = 'Puasa full aktif âœ“';
                status.classList.add('text-emerald-400');
            } else {
                status.textContent = 'Tap toggle untuk puasa full';
                status.classList.remove('text-emerald-400');
            }
            
            updateAmalan(true);
        }
        
        // Update amalan with auto-save
        function updateAmalan(shouldAutoSave) {
            if (appData.haid.active) {
                document.querySelectorAll('.amalan-item input[type="checkbox"]').forEach(function(cb) {
                    cb.disabled = true;
                    cb.closest('.amalan-item').classList.add('opacity-50');
                });
                document.getElementById('toggle-puasa').style.pointerEvents = 'none';
                return;
            } else {
                document.querySelectorAll('.amalan-item input[type="checkbox"]').forEach(function(cb) {
                    cb.disabled = false;
                    cb.closest('.amalan-item').classList.remove('opacity-50');
                });
                document.getElementById('toggle-puasa').style.pointerEvents = 'auto';
            }
            
            let total = 0;
            
            // Puasa
            const puasaToggle = document.getElementById('toggle-puasa');
            const isPuasa = puasaToggle.classList.contains('active');
            if (isPuasa) total += 100;
            
            // Sholat wajib
            const sholatStatus = {};
            ['subuh', 'dzuhur', 'ashar', 'maghrib', 'isya'].forEach(function(w) {
                const cb = document.getElementById('sholat-' + w);
                const checked = cb ? cb.checked : false;
                sholatStatus[w] = checked;
                if (checked) total += 20;
            });
            
            // Sunnah
            const sunnahStatus = {
                rawatib: document.getElementById('sunnah-rawatib').checked,
                dhuha: document.getElementById('sunnah-dhuha').checked,
                tahajud: document.getElementById('sunnah-tahajud').checked,
                witir: document.getElementById('sunnah-witir').checked
            };
            
            if (sunnahStatus.rawatib) total += 50;
            if (sunnahStatus.dhuha) total += 30;
            if (sunnahStatus.tahajud) total += 100;
            
            // Tarawih with rakaat
            const tarawihCheck = document.getElementById('sunnah-tarawih');
            const tarawihRakaat = parseInt(document.getElementById('tarawih-rakaat').value) || 0;
            const isTarawih = tarawihCheck.checked;
            
            if (isTarawih && tarawihRakaat > 0) {
                const tarawihPoints = Math.min(Math.floor((tarawihRakaat / 23) * 100), 100);
                total += tarawihPoints;
                document.getElementById('tarawih-points').textContent = tarawihPoints + ' poin (' + tarawihRakaat + ' rakaat)';
            } else {
                document.getElementById('tarawih-points').textContent = '0 poin';
            }
            
            if (sunnahStatus.witir) total += 40;
            
            // Ngaji
            const suratAwal = document.getElementById('ngaji-surat-awal').value;
            const ayatAwal = parseInt(document.getElementById('ngaji-ayat-awal').value) || 0;
            const suratAkhir = document.getElementById('ngaji-surat-akhir').value;
            const ayatAkhir = parseInt(document.getElementById('ngaji-ayat-akhir').value) || 0;
            
            let ngajiPoints = 0;
            let ayatCount = 0;
            
            if (suratAwal !== '' && ayatAwal > 0 && ayatAkhir > 0) {
                const sAwal = parseInt(suratAwal);
                
                if (!suratAkhir || suratAkhir === '' || parseInt(suratAkhir) === sAwal) {
                    ayatCount = ayatAkhir - ayatAwal + 1;
                } else {
                    const sAkhir = parseInt(suratAkhir);
                    ayatCount += suratList[sAwal].ayat - ayatAwal + 1;
                    for (let i = sAwal + 1; i < sAkhir; i++) {
                        ayatCount += suratList[i].ayat;
                    }
                    ayatCount += ayatAkhir;
                }
                
                ngajiPoints = Math.min(ayatCount * 2, 200);
                total += ngajiPoints;
                document.getElementById('ngaji-total').textContent = ayatCount + ' ayat â€¢ ' + ngajiPoints + ' poin';
            } else {
                document.getElementById('ngaji-total').textContent = '0 ayat â€¢ 0 poin';
            }
            
            // Lainnya
            const isDzikir = document.getElementById('lain-dzikir').checked;
            if (isDzikir) total += 40;
            
            const infaq = parseInt(document.getElementById('lain-infaq').value) || 0;
            total += Math.floor(infaq / 1000);
            
            // Update UI
            document.getElementById('current-points').textContent = total;
            const percent = Math.min((total / 1000) * 100, 100);
            document.getElementById('progress-percent').textContent = Math.floor(percent) + '%';
            document.getElementById('progress-bar').style.width = percent + '%';
            document.getElementById('progress-circle').setAttribute('stroke-dasharray', percent + ', 100');
            
            // Save to current day data
            const todayStr = getCurrentFastingDate();
            appData.currentDay.date = todayStr;
            appData.currentDay.data = {
                date: todayStr,
                score: total,
                puasa: isPuasa,
                sholat: sholatStatus,
                sunnah: sunnahStatus,
                tarawih: { done: isTarawih, rakaat: tarawihRakaat },
                ngaji: { 
                    suratAwal: suratAwal, 
                    ayatAwal: ayatAwal, 
                    suratAkhir: suratAkhir, 
                    ayatAkhir: ayatAkhir 
                },
                lain: { dzikir: isDzikir, infaq: infaq },
                haid: appData.haid.active
            };
            
            // Auto-save with debounce
            if (shouldAutoSave) {
                if (autoSaveTimeout) clearTimeout(autoSaveTimeout);
                autoSaveTimeout = setTimeout(function() {
                    autoSave();
                }, 1000); // Save 1 second after last change
            }
            
            // Celebration if reached 500
            if (total >= 500 && !window.celebrated500) {
                window.celebrated500 = true;
                celebrate500();
            }
        }
        
        function autoSave() {
            const todayStr = getCurrentFastingDate();
            
            // Save to history
            appData.history[todayStr] = appData.currentDay.data;
            
            // Save to localStorage
            saveData();
            
            // Show indicator
            const indicator = document.getElementById('auto-save-indicator');
            indicator.classList.add('show');
            setTimeout(function() {
                indicator.classList.remove('show');
            }, 2000);
            
            // Update calendar and profile
            renderCalendar();
            updateProfile();
        }
        
        function manualSave() {
            autoSave();
            
            const btn = document.getElementById('save-btn');
            btn.innerHTML = '<i class="fas fa-check mr-2"></i> Tersimpan!';
            btn.classList.add('bg-emerald-600');
            setTimeout(function() {
                btn.innerHTML = '<i class="fas fa-save mr-2"></i> Simpan Progress';
                btn.classList.remove('bg-emerald-600');
            }, 2000);
        }
        
        function celebrate500() {
            const container = document.getElementById('celebration-container');
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.background = ['#d4af37', '#f4e4bc', '#10b981', '#3b82f6'][Math.floor(Math.random() * 4)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(confetti);
            }
            
            for (let i = 0; i < 10; i++) {
                const star = document.createElement('div');
                star.className = 'star-burst';
                star.textContent = 'âœ¨';
                star.style.left = (50 + (Math.random() - 0.5) * 40) + '%';
                star.style.top = (50 + (Math.random() - 0.5) * 40) + '%';
                star.style.animationDelay = Math.random() * 0.5 + 's';
                container.appendChild(star);
            }
            
            const msg = document.createElement('div');
            msg.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center z-50';
            msg.innerHTML = '<div class="text-6xl mb-4">ðŸŽ‰</div><h2 class="text-3xl font-serif text-gold font-bold">Alhamdulillah!</h2><p class="text-white mt-2">Target minimal tercapai</p>';
            msg.style.animation = 'fadeIn 0.5s ease-out';
            container.appendChild(msg);
            
            setTimeout(function() {
                container.innerHTML = '';
                window.celebrated500 = false;
            }, 4000);
        }
        
        // Haid Functions
        function toggleHaid(active) {
            appData.haid.active = active;
            
            if (active) {
                appData.haid.startDate = new Date().toDateString();
                document.getElementById('haid-banner').style.display = 'block';
                document.getElementById('btn-haid-on').classList.add('hidden');
                document.getElementById('btn-haid-off').classList.remove('hidden');
                document.getElementById('haid-status-text').textContent = 'Sedang haid';
                
                // Disable all inputs
                document.querySelectorAll('.amalan-item input, .amalan-item select').forEach(function(input) {
                    input.disabled = true;
                });
                document.getElementById('toggle-puasa').style.pointerEvents = 'none';
                
                // Save current state as haid day
                const todayStr = getCurrentFastingDate();
                appData.history[todayStr] = {
                    date: todayStr,
                    haid: true,
                    puasa: false,
                    score: 0
                };
            } else {
                document.getElementById('haid-banner').style.display = 'none';
                document.getElementById('btn-haid-on').classList.remove('hidden');
                document.getElementById('btn-haid-off').classList.add('hidden');
                document.getElementById('haid-status-text').textContent = 'Tidak haid';
                
                // Re-enable inputs
                document.querySelectorAll('.amalan-item input, .amalan-item select').forEach(function(input) {
                    input.disabled = false;
                });
                document.getElementById('toggle-puasa').style.pointerEvents = 'auto';
            }
            
            saveData();
            renderCalendar();
            updateAmalan(true);
        }
        
        function checkHaidStatus() {
            if (appData.haid.active) {
                toggleHaid(true);
            }
        }
        
        // Todo Functions
        function toggleTodoSlide() {
            const toggle = document.getElementById('todo-toggle');
            const slider = document.getElementById('todo-slider');
            const labelLeft = document.getElementById('todo-label-left');
            const labelRight = document.getElementById('todo-label-right');
            
            toggle.classList.toggle('active');
            
            if (toggle.classList.contains('active')) {
                slider.style.transform = 'translateX(-100%)';
                labelLeft.classList.remove('text-slate-300');
                labelLeft.classList.add('text-slate-500');
                labelRight.classList.remove('text-slate-500');
                labelRight.classList.add('text-slate-300');
                currentTodoType = 'workout';
            } else {
                slider.style.transform = 'translateX(0)';
                labelLeft.classList.add('text-slate-300');
                labelLeft.classList.remove('text-slate-500');
                labelRight.classList.add('text-slate-500');
                labelRight.classList.remove('text-slate-300');
                currentTodoType = 'reading';
            }
        }
        
        function openTodoModal(type) {
            currentTodoType = type;
            document.getElementById('modal-title').textContent = type === 'reading' ? 'Tambah Target Bacaan' : 'Tambah Target Workout';
            document.getElementById('todo-modal').classList.remove('hidden');
        }
        
        function closeTodoModal() {
            document.getElementById('todo-modal').classList.add('hidden');
            document.getElementById('todo-title').value = '';
            document.getElementById('todo-desc').value = '';
            document.getElementById('todo-points').value = '20';
        }
        
        function setTodoFrequency(freq) {
            appData.todoFrequency = freq;
            document.getElementById('freq-daily').classList.toggle('border-amber-500', freq === 'daily');
            document.getElementById('freq-daily').classList.toggle('bg-amber-500/10', freq === 'daily');
            document.getElementById('freq-daily').classList.toggle('text-amber-400', freq === 'daily');
            document.getElementById('freq-weekly').classList.toggle('border-amber-500', freq === 'weekly');
            document.getElementById('freq-weekly').classList.toggle('bg-amber-500/10', freq === 'weekly');
            document.getElementById('freq-weekly').classList.toggle('text-amber-400', freq === 'weekly');
            document.getElementById('days-selector').style.display = freq === 'weekly' ? 'block' : 'none';
        }
        
        function saveTodo() {
            const title = document.getElementById('todo-title').value;
            const points = parseInt(document.getElementById('todo-points').value) || 20;
            const desc = document.getElementById('todo-desc').value;
            
            if (!title) return;
            
            const todo = {
                id: Date.now(),
                title: title,
                points: points,
                description: desc,
                frequency: appData.todoFrequency,
                days: appData.todoFrequency === 'weekly' ? Array.from(document.querySelectorAll('#days-selector input:checked')).map(function(cb) { return cb.value; }) : [0,1,2,3,4,5,6],
                completed: {},
                createdAt: new Date().toISOString()
            };
            
            appData.todos[currentTodoType].push(todo);
            saveData();
            renderTodos();
            closeTodoModal();
        }
        
        function renderTodos() {
            ['reading', 'workout'].forEach(function(type) {
                const container = document.getElementById(type + '-list');
                if (!container) return;
                container.innerHTML = '';
                
                appData.todos[type].forEach(function(todo) {
                    const today = new Date().getDay();
                    const isToday = todo.days.includes(String(today));
                    const isCompleted = todo.completed[new Date().toDateString()];
                    
                    const item = document.createElement('div');
                    item.className = 'glass-card rounded-2xl p-4 border-l-4 ' + (type === 'reading' ? 'border-l-purple-500/50' : 'border-l-amber-500/50') + ' ' + (isCompleted ? 'opacity-50' : '');
                    
                    item.innerHTML = 
                        '<div class="flex items-start justify-between">' +
                            '<div class="flex-1 min-w-0">' +
                                '<h4 class="text-white font-medium ' + (isCompleted ? 'line-through' : '') + ' truncate">' + todo.title + '</h4>' +
                                (todo.description ? '<p class="text-xs text-slate-400 mt-1 line-clamp-2">' + todo.description + '</p>' : '') +
                                '<p class="text-xs ' + (type === 'reading' ? 'text-purple-400' : 'text-amber-400') + ' mt-2">+' + todo.points + ' poin</p>' +
                            '</div>' +
                            '<button onclick="toggleTodoCheck(' + todo.id + ', \'' + type + '\')" class="w-8 h-8 rounded-full ' + (isCompleted ? 'bg-emerald-500 text-white' : 'bg-slate-700 text-slate-400') + ' flex items-center justify-center transition flex-shrink-0 ml-2">' +
                                '<i class="fas fa-check text-sm"></i>' +
                            '</button>' +
                        '</div>';
                    
                    container.appendChild(item);
                });
            });
        }
        
        function toggleTodoCheck(id, type) {
            const todo = appData.todos[type].find(function(t) { return t.id === id; });
            if (!todo) return;
            
            const today = new Date().toDateString();
            if (todo.completed[today]) {
                delete todo.completed[today];
            } else {
                todo.completed[today] = true;
                createMiniCelebration();
            }
            
            saveData();
            renderTodos();
            updateProfile();
        }
        
        function createMiniCelebration() {
            const container = document.getElementById('celebration-container');
            for (let i = 0; i < 10; i++) {
                const star = document.createElement('div');
                star.className = 'star-burst';
                star.textContent = 'âœ¨';
                star.style.left = (80 + Math.random() * 20) + '%';
                star.style.top = (50 + Math.random() * 30) + '%';
                star.style.animationDelay = Math.random() * 0.3 + 's';
                container.appendChild(star);
            }
            setTimeout(function() {
                container.innerHTML = '';
            }, 1500);
        }
        
        // Calendar Functions
        function renderCalendar() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            document.getElementById('calendar-month').textContent = 
                currentMonth.toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < firstDay; i++) {
                const empty = document.createElement('div');
                grid.appendChild(empty);
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = date.toDateString();
                const dayData = appData.history[dateStr];
                const isToday = date.toDateString() === new Date().toDateString();
                
                const cell = document.createElement('div');
                let classes = 'calendar-day';
                
                if (isToday) classes += ' today';
                if (dayData && dayData.haid) classes += ' no-fasting';
                else if (dayData && dayData.puasa) classes += ' active has-data';
                
                cell.className = classes;
                cell.textContent = day;
                cell.onclick = function() { showDayDetail(dateStr); };
                
                grid.appendChild(cell);
            }
        }
        
        function changeMonth(delta) {
            currentMonth.setMonth(currentMonth.getMonth() + delta);
            renderCalendar();
            document.getElementById('day-detail').classList.add('hidden');
        }
        
        function showDayDetail(dateStr) {
            const data = appData.history[dateStr];
            const detail = document.getElementById('day-detail');
            const date = new Date(dateStr);
            
            document.getElementById('day-detail-date').textContent = 
                date.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
            
            if (!data) {
                document.getElementById('day-detail-score').textContent = '0 poin';
                document.getElementById('day-detail-content').innerHTML = '<p class="text-slate-500 text-sm text-center py-4">Belum ada data</p>';
                detail.classList.remove('hidden');
                return;
            }
            
            document.getElementById('day-detail-score').textContent = (data.score || 0) + ' poin';
            
            let content = '';
            
            if (data.haid) {
                content += '<div class="flex items-center gap-2 text-rose-400 text-sm"><i class="fas fa-heart"></i> Hari haid (tidak puasa)</div>';
            } else {
                if (data.puasa) {
                    content += '<div class="flex items-center gap-2 text-emerald-400 text-sm"><i class="fas fa-check-circle"></i> Puasa full</div>';
                } else {
                    content += '<div class="flex items-center gap-2 text-slate-500 text-sm"><i class="fas fa-times-circle"></i> Tidak puasa</div>';
                }
                
                const sholatCount = Object.values(data.sholat).filter(function(v) { return v; }).length;
                content += '<div class="flex items-center gap-2 text-blue-400 text-sm"><i class="fas fa-mosque"></i> Sholat: ' + sholatCount + '/5 waktu</div>';
                
                if (data.tarawih && data.tarawih.done) {
                    content += '<div class="flex items-center gap-2 text-emerald-400 text-sm"><i class="fas fa-moon"></i> Tarawih: ' + data.tarawih.rakaat + ' rakaat</div>';
                }
            }
            
            document.getElementById('day-detail-content').innerHTML = content;
            detail.classList.remove('hidden');
        }
        
        // Memory Functions
        function handleMemoryUpload(input, source) {
            const files = input.files;
            if (!files.length) return;
            
            Array.from(files).forEach(function(file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const memory = {
                        id: Date.now(),
                        image: e.target.result,
                        date: new Date().toISOString(),
                        description: '',
                        source: source
                    };
                    appData.memories.unshift(memory);
                    saveData();
                    renderMemories();
                    
                    const container = document.getElementById('celebration-container');
                    const cam = document.createElement('div');
                    cam.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-6xl float-animation';
                    cam.textContent = 'ðŸ“¸';
                    container.appendChild(cam);
                    setTimeout(function() { container.innerHTML = ''; }, 2000);
                };
                reader.readAsDataURL(file);
            });
        }
        
        function renderMemories() {
            const container = document.getElementById('memories-list');
            container.innerHTML = '';
            
            appData.memories.forEach(function(mem, idx) {
                const date = new Date(mem.date);
                const timeStr = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' }) + ' â€¢ ' + 
                               date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                
                const item = document.createElement('div');
                item.className = 'memory-item glass-card rounded-2xl overflow-hidden';
                item.innerHTML = 
                    '<img src="' + mem.image + '" class="w-full aspect-video object-cover">' +
                    '<div class="p-4">' +
                        '<div class="flex justify-between items-start mb-2">' +
                            '<p class="text-[10px] text-slate-500">' + timeStr + '</p>' +
                            '<button onclick="deleteMemory(' + idx + ')" class="text-rose-400 hover:text-rose-300 text-xs"><i class="fas fa-trash"></i></button>' +
                        '</div>' +
                        '<textarea onchange="updateMemoryDesc(' + idx + ', this.value)" placeholder="Tambahkan keterangan..." class="w-full bg-transparent text-sm text-slate-300 resize-none focus:outline-none expandable-text" rows="2">' + (mem.description || '') + '</textarea>' +
                    '</div>';
                
                container.appendChild(item);
            });
        }
        
        function updateMemoryDesc(idx, value) {
            appData.memories[idx].description = value;
            saveData();
        }
        
        function deleteMemory(idx) {
            if (confirm('Hapus kenangan ini?')) {
                appData.memories.splice(idx, 1);
                saveData();
                renderMemories();
            }
        }
        
        // Profile Functions
        function updateProfilePhoto(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                appData.profile.photo = e.target.result;
                document.getElementById('profile-photo').src = e.target.result;
                document.getElementById('profile-photo').classList.remove('hidden');
                document.getElementById('profile-default-icon').classList.add('hidden');
                saveData();
            };
            reader.readAsDataURL(file);
        }
        
        function saveProfile() {
            appData.profile.name = document.getElementById('profile-name').value;
            appData.profile.quote = document.getElementById('profile-quote').value;
            saveData();
        }
        
        function updateProfile() {
            if (appData.profile.name) {
                document.getElementById('profile-name').value = appData.profile.name;
            }
            if (appData.profile.quote) {
                document.getElementById('profile-quote').value = appData.profile.quote;
            }
            if (appData.profile.photo) {
                document.getElementById('profile-photo').src = appData.profile.photo;
                document.getElementById('profile-photo').classList.remove('hidden');
                document.getElementById('profile-default-icon').classList.add('hidden');
            }
            
            const history = Object.values(appData.history);
            const fastingDays = history.filter(function(h) { return h.puasa && !h.haid; });
            
            document.getElementById('profile-total-days').textContent = fastingDays.length;
            
            if (fastingDays.length > 0) {
                const totalScore = fastingDays.reduce(function(sum, h) { return sum + (h.score || 0); }, 0);
                const avg = Math.floor(totalScore / fastingDays.length);
                const best = Math.max.apply(null, fastingDays.map(function(h) { return h.score || 0; }));
                
                document.getElementById('profile-avg-score').textContent = avg;
                document.getElementById('profile-best-score').textContent = best;
            } else {
                document.getElementById('profile-avg-score').textContent = '0';
                document.getElementById('profile-best-score').textContent = '0';
            }
        }
        
        // Navigation
        function switchTab(tab) {
            document.querySelectorAll('.page-content').forEach(function(p) { p.classList.add('hidden'); });
            document.getElementById('page-' + tab).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(function(n) { n.classList.remove('active'); });
            document.getElementById('nav-' + tab).classList.add('active');
            
            if (tab === 'profile') {
                renderCalendar();
                updateProfile();
            } else if (tab === 'todo') {
                renderTodos();
            }
        }
        
        // Storage
        function saveData() {
            localStorage.setItem('ramadanApp2026_v3', JSON.stringify(appData));
        }
        
        function loadData() {
            const saved = localStorage.getItem('ramadanApp2026_v3');
            if (saved) {
                appData = JSON.parse(saved);
            }
        }
    </script>
</body>
</html>
